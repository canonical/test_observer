type: charm
name: test-observer-frontend
title: Test Observer Frontend
summary: A Flutter based frontend for Test Observer
description: |
  Test Observer is a tool to track test results of artefacts across environments.

   A user interested in testing an artefact (a deb, snap, charm or image)
   across different environments (particular machines or cloud setups)
   can use Test Observer as means for storing, viewing and comparing results
   with previous runs or versions of an artefact.
   The last use case is particularly useful for catching regressions.
   Additionally, Test Observer provides a mechanism
   to assign reviewers that can look at results
   and mark artefacts as approved or failed to gate updates.
   It is important to note that Test Observer does not run the tests itself,
   but provides an API with which users can report the results of those tests.

  This charm provides the Flutter-based frontend for Test Observer.

base: ubuntu@22.04
platforms:
  amd64:

parts:
  charm:
    plugin: charm
    source: .
    charm-entrypoint: src/charm.py
    charm-requirements:
      - requirements.txt

assumes:
  - juju >= 2.9
  - k8s-api

config:
  options:
    hostname:
      description: Hostname for the service
      type: string
    hostname_backend:
      description: Hostname for the connected backend
      type: string
    port:
      description: Port for the frontend (through ingress)
      default: 80
      type: int
    scheme:
      description: Scheme for accessing Test Observer API (used to construct URLs for API requests)
      default: "https://"
      type: string

resources:
  frontend-image:
    type: oci-image
    description: OCI image for test-observer-frontend
    upstream-source: ghcr.io/canonical/test_observer/frontend:main

containers:
  frontend:
    resource: frontend-image

charm-libs:
  - lib: traefik_k8s.ingress
    version: "2"

requires:
  test-observer-rest-api:
    interface: http
    limit: 1
  ingress:
    interface: ingress
    limit: 1
    optional: false
