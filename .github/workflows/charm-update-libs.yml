# Copyright 2025 Canonical Ltd.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-FileCopyrightText: Copyright 2025 Canonical Ltd.
# SPDX-License-Identifier: Apache-2.0

name: Auto-update Charm Libraries
permissions: {}
on:
  workflow_dispatch:
  schedule:
    - cron: "0 */4 * * *"

jobs:
  update-lib:
    name: Update Libraries
    permissions:
      contents: write  # Necessary to create branches
      pull-requests: write  # Necessary to create PR with updated libs
    uses: canonical/observability/.github/workflows/charm-update-libs.yaml@dd6c66dc595da864fcc880464f9d7526aa2d6b2b # v1
    strategy:
      fail-fast: false  # Allow all jobs to run even if one fails
      matrix:
        include:
          - charm-path: backend/charm
            git-branch: chore/auto-libs-backend
          - charm-path: frontend/charm
            git-branch: chore/auto-libs-frontend
    secrets:
      CHARMHUB_TOKEN: ${{ secrets.CHARMHUB_TOKEN }}
      OBSERVABILITY_NOCTUA_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      NOCTUA_GPG_PRIVATE: ${{ secrets.BOT_GPG_PRIVATE }}
      NOCTUA_GPG_PASSPHRASE: ${{ secrets.BOT_GPG_PASSPHRASE }}
    with:
      charm-path: ${{ matrix.charm-path }}
      git-branch: ${{ matrix.git-branch }}
      commit-username: Canonical-Certification-Bot
      commit-email: solutions-qa@lists.canonical.com

